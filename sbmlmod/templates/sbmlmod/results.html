{% extends "sbmlmod/base.html" %}
{% load staticfiles %}

{% block menu-bar %}
	<li><a href="/sbmlmod/">Home</a></li>
	<li><a href="/sbmlmod/help/">Help</a></li>
{% endblock %}

{% block content %}
{% if copasi_fault %}
	<p class="error">{{ copasi_fault }}</p>
{% endif %}
	<div class="span-12">
		<div class="contentbox">
			<h1>Result files</h1>
			<table>
				<tr>
					<th>SBML model</th>
					{% if copasi_results %}
					<th>Simulation</th>
					{% else %}
					<th></th>
					{% endif %}
				</tr>
				{% for name in result_names %}
				<tr>
					<td><a href="/sbmlmod/results/{{ name }}"><img src="{% static 'sbmlmod/images/text-xml.png' %}" alt="Zip archive"/> {{ name }} model</a></td>
					{% if copasi_results %}
					<td><a href="/sbmlmod/results/simulations/{{ name }}"><img src="{% static 'sbmlmod/images/text-plain.png' %}" alt="Zip archive"/> {{ name }} simulation</a></td>
					{% else %}
					<td></td>
					{% endif %}
				</tr>
				{% endfor %}
				<tr>
					<td>
						<a href="/sbmlmod/results/get_models_zipped/"><img style="float:left" src="{% static 'sbmlmod/images/application-zip.png' %}" alt="Zip archive"/> Zipped archive of models</a>
					</td>
					{% if copasi_results %}
					<td><a href="/sbmlmod/results/get_simulations_zipped/"><img style="float:left" src="{% static 'sbmlmod/images/application-zip.png' %}" alt="Zip archive"/> Zipped archive of simulations</a>
					</td>
					{% else %}
					<td></td>
					{% endif %}
				</tr>
			</table>
		</div>
		{% if warnings %}
		<div class="warnings">
			<a href="javascript:toggleWarnings();"><span id="warningsLink">Hide warnings</span></a>
			<div id="show_warnings" class="unhidden">
				<textarea>
{% for warning in warnings %}{{ warning }}

{% endfor %}
				</textarea>
			</div>
		</div>
		{% endif %}
	</div>

	<div class="span-12 last">
		<form action="" method="post" enctype="multipart/form-data">
		{% csrf_token %}
		<div class="queryform">
			<h1>Perform additional analysis</h1>
			{% if form.errors %}
			<p class="error">
				Please correct the error{{ form.errors|pluralize }} below.
			</p>
			<p>
				{{ form.errors }}
			</p>
			{% endif %}
			{% for err in error %}
			<p class="error">
				{{ err }}
			</p>
			{% endfor %}

			{% if not kl_done %}
			<fieldset>
				<legend>Adjust parameters <img src="{% static 'sbmlmod/images/help_16.png' %}" alt="help" /></legend>
				<p>
					{{ form.global_parameters }} <label for="id_global_parameters">Global parameters</label>
					{{ form.kinetic_law_parameters }} <label for="id_kinetic_law_parameters">Kinetic law parameters</label>
				</p>
				<p>
					<label for="id_parameter">Parameter:</label>
					{{ form.parameter }} (E_T for example files)
				</p>
				<p>
					{% for radio in form.replace_or_scale %}{{ radio }}{% endfor %}
				</p>
				<p>
					Merge mode:
					{{ form.kl_merge_mode }}
				</p>
				<p class="right">
					<button type="submit" name="kinetic"><img src="{% static 'sbmlmod/images/system-run-5.png' %}" alt="Run" /></button>
				</p>
			</fieldset>
			{% endif %}
			{% if not b_done %}
			<fieldset>
				<legend>Add kinetic law bounds <img src="{% static 'sbmlmod/images/help_16.png' %}" alt="help" /></legend>
				<table class="left">
				<tr>
					<td><label for="id_bounds_default">Bounds default value:</label></td>
					<td>{{ form.bounds_default }}</td>
					<td><img src="{% static 'sbmlmod/images/help_16.png' %}" alt="help" /></td>
				</tr>
				<tr>
					<td><label for="id_b_merge_mode">Merge mode:</label></td>
					<td>{{ form.b_merge_mode }}</td>
					<td><img src="{% static 'sbmlmod/images/help_16.png' %}" alt="help" /></td>
				</tr>
				</table>
				<p class="right">
					<button type="submit" name="bounds"><img src="{% static 'sbmlmod/images/system-run-5.png' %}" alt="Run" /></button>
				</p>
			</fieldset>
			{% endif %}
			{% if not s_done %}
			<fieldset>
				<legend>Adjust initial species concentrations <img src="{% static 'sbmlmod/images/help_16.png' %}" alt="help" /></legend>

				<p class="right">
					<button type="submit" name="species"><img src="{% static 'sbmlmod/images/system-run-5.png' %}" alt="Run" /></button>
				</p>
			</fieldset>
			{% endif %}
			{% if not copasi_done %}
			<fieldset>
				<legend>Perform steady state analysis with COPASI</legend>

				<p class="right">
					<button type="submit" name="copasi"><img src="{% static 'sbmlmod/images/system-run-5.png' %}" alt="Run" /></button>
				</p>
			</fieldset>
			{% endif %}

			{% if copasi_done and s_done and b_done and kl_done and not copasi_fault %}
			<p class="success">
				All analyses have been completed.
			</p>
			{% elif copasi_done and s_done and b_done and kl_done and copasi_fault %}
			<p class="error">
				All analyses have been completed, but errors occured.
			</p>
			{% endif %}

		</div>
		</form>
	</div>

{% endblock %}
